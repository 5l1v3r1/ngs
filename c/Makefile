all: ngs

scanner.lex:
	# nothing
parser.y:
	# nothing

parser.h: parser.y
	bison --defines=parser.h -o parser.c parser.y

parser.c: parser.y
	bison --defines=parser.h -o parser.c parser.y

scanner.c: scanner.lex Makefile
	flex -o $@ $<
	# Eliminate warnings about unused variables in generated code which is not even generated by me.
	sed -i '/^\(static\|void\).*\(yyalloc\|yyrealloc\|yyfree\|yy_fatal_error\) /{s/\(, *yyscan_t yyscanner\)/\1 __attribute__((__unused__))/}' $@

ngs: *.c *.h Makefile
	# -gdwarf-2 -g3 -- for debugging macros
	# -rdynamic -- for backtrace_symbols() to work
	gcc -Wall -Wextra -gdwarf-2 -g3 -g -rdynamic -o $@ ngs.c -lfl -lpthread -lgc

clean:
	-rm parser.h parser.c
	-rm scanner.c
	-rm ngs

tags: *.c *.h
	ctags $^
