# WIP, don't use!

debug("Starting NGS CLI")

echo("*** NGS CLI is under construction ***")

F cli_show_prompt() {
	local p = cli_prompt.map(F(k, v) {
		v()
	}).join(' ')
	echo(p)
}

F cli() {
	local readline_lib = CLib(cli_readline_lib)
	local readline_c_func = readline_lib['readline']
	local readline_cif = c_ffi_prep_cif(c_ffi_type_pointer, [c_ffi_type_pointer])

	while true {
		cli_show_prompt()
		c_ffi_call(readline_cif, readline_c_func, ["NGS> "])

	}
}

# --- Start ---

cli_readline_lib = 'libreadline.so.6'

# TODO: make it object, not a string
cli_prompt = {
	'ngs': F() "NGS"
	'dir': F() { local p = $(pwd).Str(); p[0..len(p)-1] }
	'gt': F() ">"
}

cli()
